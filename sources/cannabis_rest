#!/usr/bin/env bash
SOURCE_DESC80="Canabas mulitiple visits"
  
SUBJECTS_DIR="/data/Luna1/WorkingMemory/FS_Subjects/" 
DICOM_PAT="MR*"


FUNCTR="2"
FUNCSLICEACQ="seqasc"

MRROOT="/data/Luna1/Raw/WorkingMemory/"


# given an id, pattern, and dicomcount
# echo the 1 directory that matches or return error
function subj_t1 {
 wantonlyoneid $@ || return 1
 ## HACKS to support weird subjects (have 2 or more mprage sequences)

 # subj_mr_pat: count not exactly 1 '/data/Luna1/Raw/WorkingMemory//10905_20111212/axial_mprage_G2_256x192.11 /data/Luna1/Raw/WorkingMemory//10905_20111212/axial_mprage_G2_256x192.18'
 pick_mrfolder $1 "10905_20111212" axial_mprage_G2_256x192.18 && return 0
 pick_mrfolder $1 "11004_20120611" axial_mprage_G2_256x192.17 && return 0
 pick_mrfolder $1 "11007_20120613" axial_mprage_G2_256x192.17 && return 0
 pick_mrfolder $1 "11009_20120615" axial_mprage_G2_256x192.17 && return 0
 pick_mrfolder $1 "11020_20120628" axial_mprage_G2_256x192.11 && return 0
 pick_mrfolder $1 "11022_20150619" axial_mprage_G2_256x192.11 && return 0
 pick_mrfolder $1 "11045_20150608" axial_mprage_G2_256x192.12 && return 0

 # for normal subjects
 subj_mr_pat $MRROOT/$1 'axial_mprage_G2_256x192*' 192 || return 1
 return 0
}

function subj_t2 {
 wantonlyoneid $@ || return 1

 ## HACKS for weird subjects
 #subj_mr_pat: count not exactly 1 '/data/Luna1/Raw/WorkingMemory//10907_20141215/Rest_2_768x720.10 /data/Luna1/Raw/WorkingMemory//10907_20141215/Rest_768x720.9'
 pick_mrfolder $1 "10907_20141215" Rest_2_768x720.10 && return 0

 # for subjects that were run as expected
 subj_mr_pat $MRROOT/$1 '*Rest*768x720*' 150 || return 1
 return 0
}

## no ref,fm, or physio
function subj_ref {
 wantonlyoneid $@ || return 1
 echo ""
 return 0
}
function subj_fm {
 wantonlyoneid $@ || return 1
 echo ""
 return 0
}

function subj_physio {
 wantonlyoneid $@ || return 1
 echo "NO PHYSIO FOR THIS PROTCOL" >&2
 echo ""
 return 1
}

function list_all {
#  cut -f 1 -d' '  /opt/ni_tools/preproc_pipelines/scripts/canabas/txt/kidsvisitsuptodate.txt |sort|uniq| while read luna; do ls -d /data/Luna1/Raw/WorkingMemory/$luna*/Rest*768x720*; done|perl -lne 'print $1 if /(\d{5}_\d{8})/' > ids.txt
 cat <<HEREDOC
10898_20111128
10899_20111129
10905_20111212
10905_20150603
10906_20111214
10906_20141016
10907_20111216
10907_20141215
10907_20141215
10909_20111221
10909_20141220
10916_20120106
10916_20140924
10919_20120111
10924_20120119
10925_20120121
10925_20141229
10926_20120125
10926_20141015
10928_20120130
10928_20141024
10929_20120131
10929_20141201
10930_20120201
10930_20141121
10933_20120206
10936_20120217
10936_20150116
10937_20120220
10937_20150105
10943_20120224
10943_20150121
10944_20120229
10944_20150504
10946_20120305
10946_20150130
10947_20120306
10947_20141029
10953_20120316
10953_20150710
10956_20120320
10958_20120328
10958_20150127
10961_20120329
10963_20120402
10963_20150123
10964_20120403
10966_20120410
10967_20120409
10967_20150214
10969_20120413
10969_20150319
10970_20120416
10970_20150203
10971_20120417
10973_20120419
10973_20150128
10976_20120424
10976_20150331
10977_20120426
10977_20150508
10977_20150508
10977_20150508
10979_20120430
10979_20150422
10981_20120502
10981_20150406
10982_20120503
10984_20120507
10984_20150428
10985_20120508
10985_20150227
10986_20120509
10986_20150220
10987_20120510
10988_20120511
10988_20150323
10989_20120514
10989_20150720
10990_20120515
10990_20150511
10991_20120519
10992_20120519
10992_20150414
10993_20120519
10993_20150521
10993_20150521
10995_20150401
10996_20120522
10998_20120524
10998_20150217
10999_20120524
10999_20150309
11000_20120525
11000_20150325
11001_20120525
11002_20120530
11002_20150513
11003_20120608
11003_20150615
11004_20120611
11005_20120612
11006_20120613
11007_20120613
11007_20150430
11008_20120614
11008_20150501
11009_20120615
11009_20150407
11010_20120616
11011_20120618
11011_20150608
11012_20120619
11012_20150613
11013_20120620
11013_20150609
11014_20120620
11015_20120621
11015_20150622
11016_20120622
11017_20120626
11017_20150508
11018_20120625
11019_20120627
11019_20150610
11020_20120628
11020_20150706
11021_20120629
11021_20150429
11022_20120703
11022_20150619
11023_20120702
11029_20120707
11029_20150630
11030_20120709
11031_20120710
11031_20150605
11032_20120712
11032_20150512
11033_20120713
11033_20150713
11034_20120717
11035_20120718
11035_20150520
11036_20120718
11036_20150626
11037_20120719
11038_20120725
11038_20150506
11039_20120730
11041_20120802
11041_20150429
11044_20120813
11044_20150420
11045_20120815
11045_20150608
11048_20120817
11048_20150522
11049_20120822
HEREDOC
}
